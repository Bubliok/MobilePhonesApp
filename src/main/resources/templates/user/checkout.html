<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" th:href="@{/css/checkout.css}">
    <link rel="stylesheet" href="/css/navbar.css"/>
    <link rel="stylesheet" type="text/css" href="/css/footer.css">
    <link rel="stylesheet" href="/css/filters.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
</head>
<body>
<div th:replace="~{fragments/navbar :: header}">
    <header></header>
</div>
<div class="filter-section" th:replace="~{fragments/filters :: filters}"></div>
    <div class="checkout-container">
        <form th:action="@{/checkout}" th:object="${orderRequest}" method="post" class="checkout-form">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <section class="shipping-method">
                <h2>1. Shipping Method</h2>
                <div class="shipping-options">
                    <label class="shipping-option selected">
                        <input type="radio" th:field="*{deliveryMethod}" value="ECONT" checked>
                        <span class="option-details">
                            <span class="option-title">Econt express</span>
                            <span class="option-subtitle">At most 1 business day</span>
                        </span>
                        <span class="price">Free</span>
                    </label>
                    <label class="shipping-option">
                        <input type="radio" th:field="*{deliveryMethod}" value="PICKUP">
                        <span class="option-details">
                            <span class="option-title">Pickup from warehouse</span>
                            <span class="option-subtitle">Same day delivery</span>
                        </span>
                        <span class="price">Free</span>
                    </label>
                </div>
            </section>

            <!-- Shipping Address -->
            <section class="shipping-address">
                <h2>2. Shipping Address</h2>
<!--                <form action=""></form>-->
                <div class="form-row">
                    <input type="text" th:field="*{firstName}" placeholder="First Name" required>
                    <input type="text" th:field="*{lastName}" placeholder="Last Name" required>
                </div>

                <input type="text" placeholder="Company (optional)" class="full-width">

                <div class="form-row">
                    <input type="text" th:field="*{address}" placeholder="Address" required class="address-input">
                </div>

                <div class="form-row">
                    <input type="tel" th:field="*{phoneNumber}" placeholder="Phone number" required>

                    <input list="cities" th:field="*{city}" placeholder="City" required>
                    <datalist id="cities">
                        <option value="Sofia">
                        <option value="Plovdiv">
                        <option value="Varna">
                        <option value="Burgas">
                        <option value="Ruse">
                    </datalist>

                    <input type="text" th:field="*{zipCode}" placeholder="Zip" required>
                </div>

            </section>

            <!-- Payment Method -->
            <section class="payment-method">
                <h2>3. Payment Method</h2>
                <div class="payment-options">
                    <label class="payment-option selected">
                        <input type="radio" th:field="*{paymentMethod}" value="CARD" checked>
                        <span>Card</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" th:field="*{paymentMethod}" value="CASH">
                        <span>Cash</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" th:field="*{paymentMethod}" value="BANK">
                        <span>Bank transfer</span>
                    </label>
                    <label class="payment-option">
                        <input type="radio" th:field="*{paymentMethod}" value="FINANCE">
                        <span>Finance</span>
                    </label>
                </div>

                <div class="card-information">
                    <input type="text" placeholder="1234 1234 1234 1234" class="card-number">
                    <div class="card-icons">
                        <img src="/images/visa.png" alt="Visa">
                        <img src="/images/mastercard.png" alt="Mastercard">
                        <img src="/images/amex.png" alt="American Express">
                        <img src="/images/other.png" alt="Other cards">
                    </div>
                    <div class="card-details">
                        <input type="text" placeholder="MM/YY" class="expiry">
                        <input type="text" placeholder="CVC" class="cvc">
                    </div>
                    <label class="billing-checkbox">
                        <input type="checkbox" checked>
                        <span>Billing info is same as shipping</span>
                    </label>
                </div>
            </section>
        </form>

        <!-- Summary -->
        <aside class="order-summary">
            <h2 th:text="'Summary (' + ${checkoutResponse.summary} + ' items)'"></h2>
            <div class="summary-details">
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span th:text="${checkoutResponse.totalPrice}+'лв'"></span>
                </div>
                <div class="summary-row">
                    <span>Shipping</span>
                    <span>Free</span>
                </div>

                <div class="discount-section">
                    <span>Discount</span>
                    <form th:action="@{/checkout/discount}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <div class="discount-input">
                            <input type="text" name="discountCode" th:value="${discountCode}" placeholder="Gift card or discount code">
                            <button type="submit">Apply</button>
                        </div>
                    </form>

                    <!-- Optional success/error message -->
                    <div th:if="${discountApplied}" class="alert alert-success mt-2">
                        Discount applied: <span th:text="${checkoutResponse.discountPercent} + '%'"></span>
                    </div>
                    <div th:if="${!error.isEmpty()}" class="alert alert-danger mt-2" th:text="${error}"></div>
                </div>

                <div class="summary-row total">
                    <span>Total</span>
                    <span th:text="${checkoutResponse.discountPrice != null ? checkoutResponse.discountPrice : checkoutResponse.totalPrice}+'лв'"></span>
                </div>

                <button type="submit" class="checkout-button">Checkout</button>
                <button type="button" class="apple-pay-button">
                    <i class="fa-brands fa-xl fa-apple-pay"></i>
                </button>
            </div>
        </aside>

    </div>
</body>
</html>
