<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" th:href="@{/css/checkout.css}">
    <link rel="stylesheet" href="/css/navbar.css"/>
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/filters.css">
    <link rel="stylesheet" href="/css/cart.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div th:replace="~{fragments/navbar :: header}"></div>
<div class="filter-section" th:replace="~{fragments/filters :: filters}"></div>

<div class="container cart-container">
    <div class="row">
        <!-- Checkout form section -->
        <div class="col-md-8">
            <form th:action="@{/checkout}" th:object="${orderRequest}" method="post" class="checkout-form">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <!-- Delivery Method -->
                <section class="shipping-method">
                    <h2>1. Shipping Method</h2>
                    <div class="shipping-options">
                        <label class="shipping-option selected">
                            <input type="radio" th:field="*{deliveryMethod}" value="STANDARD" checked>
                            <span class="option-details">
                                <span class="option-title">Econt Express</span>
                                <span class="option-subtitle">1 business day</span>
                            </span>
                            <span class="price">Free</span>
                        </label>
                        <label class="shipping-option">
                            <input type="radio" th:field="*{deliveryMethod}" value="PICKUP">
                            <span class="option-details">
                                <span class="option-title">Pickup</span>
                                <span class="option-subtitle">Same day from warehouse</span>
                            </span>
                            <span class="price">Free</span>
                        </label>
                    </div>
                </section>

                <!-- Address -->
                <section class="shipping-address">
                    <h2>2. Shipping Address</h2>
                    <div class="form-row">
                        <input type="text" th:field="*{firstName}" placeholder="First Name" required>
                        <input type="text" th:field="*{lastName}" placeholder="Last Name" required>
                    </div>
                    <input type="text" placeholder="Company (optional)" class="full-width">
                    <div class="form-row">
                        <input type="text" th:field="*{address}" placeholder="Address" required class="address-input">
                    </div>
                    <div class="form-row">
                        <input type="tel" th:field="*{phoneNumber}" placeholder="Phone Number" required>
                        <input list="cities" th:field="*{city}" placeholder="City" required>
                        <datalist id="cities">
                            <option value="Sofia"/>
                            <option value="Plovdiv"/>
                            <option value="Varna"/>
                            <option value="Burgas"/>
                            <option value="Ruse"/>
                        </datalist>
                        <input type="text" th:field="*{zipCode}" placeholder="Zip Code" required>
                    </div>
                </section>

                <!-- Payment -->
                <section class="payment-method">
                    <h2>3. Payment Method</h2>
                    <div class="payment-options">
                        <label class="payment-option selected">
                            <input type="radio" th:field="*{paymentMethod}" value="CARD" checked>
                            <span>Card</span>
                        </label>
                        <label class="payment-option">
                            <input type="radio" th:field="*{paymentMethod}" value="CASH">
                            <span>Cash</span>
                        </label>
                    </div>

                    <!-- Card info (disabled until card is implemented) -->
                    <div class="card-information">
                        <input type="text" placeholder="1234 1234 1234 1234" class="card-number" disabled>
                        <div class="card-icons">
                            <img src="/images/visa.png" alt="Visa">
                            <img src="/images/mastercard.png" alt="Mastercard">
                            <img src="/images/amex.png" alt="Amex">
                        </div>
                        <div class="card-details">
                            <input type="text" placeholder="MM/YY" class="expiry" disabled>
                            <input type="text" placeholder="CVC" class="cvc" disabled>
                        </div>
                        <label class="billing-checkbox">
                            <input type="checkbox" checked disabled>
                            <span>Billing address same as shipping</span>
                        </label>
                    </div>
                </section>
                <div class="text-end mt-4" >
                    <button type="submit"  class="checkout-btn">Place Order</button>
                </div>
            </form>
        </div>

        <!-- Summary Section -->
        <div class="col-md-4">
            <div class="order-summary">
                <h2>Summary (<span th:text="${checkoutResponse.summary}">0</span> items)</h2>
                <div class="summary-item">
                    <span>Subtotal</span>
                    <span><span th:text="${checkoutResponse.totalPrice}">0.00</span> лв.</span>
                </div>
                <div class="summary-item">
                    <span>Shipping</span>
                    <span>Free</span>
                </div>
                <div class="summary-item">
                    <span>Discount</span>
                    <span th:if="${checkoutResponse.discountPercent != null}"
                          th:text="${checkoutResponse.discountPercent + '%'}">-</span>
                    <span th:unless="${checkoutResponse.discountPercent != null}">-</span>
                </div>

                <div th:if="${discountApplied}" class="alert alert-success mt-2">
                    Discount applied: <span th:text="${checkoutResponse.discountPercent + '%'}"></span>
                </div>
                <div th:if="${error != null && !error.isEmpty()}" class="alert alert-danger mt-2" th:text="${error}"></div>

                <!-- Total -->
                <div class="summary-total">
                    <span>Total</span>
                    <span>
                        <span th:text="${checkoutResponse.discountPrice != null ? checkoutResponse.discountPrice : checkoutResponse.totalPrice}">0.00</span> лв.
                    </span>
                </div>
                <div class="text-end mt-4" >
                    <button type="submit"  class="checkout-btn">Place Order</button>
                </div>
                <!-- Payment button (optional/Apple Pay mock) -->
                <button type="button" class="apple-pay-button mt-2">
                    <i class="fa-brands fa-2xl fa-apple-pay"></i>
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>